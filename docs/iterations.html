<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 4 Iterations | My bookdown</title>
  <meta name="description" content="This is an example of using the bookdown package. The output format for this example is bookdown::gitbook." />
  <meta name="generator" content="bookdown 0.32 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 4 Iterations | My bookdown" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="This is an example of using the bookdown package. The output format for this example is bookdown::gitbook." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 4 Iterations | My bookdown" />
  
  <meta name="twitter:description" content="This is an example of using the bookdown package. The output format for this example is bookdown::gitbook." />
  

<meta name="author" content="Carolita Landers" />


<meta name="date" content="2023-03-01" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="functions.html"/>
<link rel="next" href="exercise-1-2.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>My Intro</a></li>
<li class="chapter" data-level="1" data-path="apis-and-iteration.html"><a href="apis-and-iteration.html"><i class="fa fa-check"></i><b>1</b> API‚Äôs and Iteration</a>
<ul>
<li class="chapter" data-level="1.0.1" data-path="apis-and-iteration.html"><a href="apis-and-iteration.html#lesson-objectives"><i class="fa fa-check"></i><b>1.0.1</b> Lesson Objectives</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="apis.html"><a href="apis.html"><i class="fa fa-check"></i><b>2</b> APIs</a>
<ul>
<li class="chapter" data-level="2.1" data-path="apis.html"><a href="apis.html#nps-visitation-data"><i class="fa fa-check"></i><b>2.1</b> NPS Visitation Data</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="apis.html"><a href="apis.html#exercise-1"><i class="fa fa-check"></i><b>2.1.1</b> Exercise #1</a></li>
<li class="chapter" data-level="2.1.2" data-path="apis.html"><a href="apis.html#exercise-2"><i class="fa fa-check"></i><b>2.1.2</b> Exercise #2</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="functions.html"><a href="functions.html"><i class="fa fa-check"></i><b>3</b> Functions</a>
<ul>
<li class="chapter" data-level="3.1" data-path="functions.html"><a href="functions.html#functionize-api-pulls"><i class="fa fa-check"></i><b>3.1</b> Functionize API Pulls</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="functions.html"><a href="functions.html#exercise-3"><i class="fa fa-check"></i><b>3.1.1</b> Exercise #3</a></li>
<li class="chapter" data-level="3.1.2" data-path="functions.html"><a href="functions.html#exercise-4"><i class="fa fa-check"></i><b>3.1.2</b> Exercise #4</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="functions.html"><a href="functions.html#function-defaults"><i class="fa fa-check"></i><b>3.2</b> Function Defaults</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="functions.html"><a href="functions.html#exercise-5"><i class="fa fa-check"></i><b>3.2.1</b> Exercise #5</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="iterations.html"><a href="iterations.html"><i class="fa fa-check"></i><b>4</b> Iterations</a>
<ul>
<li class="chapter" data-level="4.1" data-path="iterations.html"><a href="iterations.html#for-loops"><i class="fa fa-check"></i><b>4.1</b> For loops</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="iterations.html"><a href="iterations.html#exercise-6"><i class="fa fa-check"></i><b>4.1.1</b> Exercise #6</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="iterations.html"><a href="iterations.html#mapping"><i class="fa fa-check"></i><b>4.2</b> Mapping</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="iterations.html"><a href="iterations.html#exercise-7"><i class="fa fa-check"></i><b>4.2.1</b> Exercise #7</a></li>
<li class="chapter" data-level="4.2.2" data-path="iterations.html"><a href="iterations.html#lesson-objectives-1"><i class="fa fa-check"></i><b>4.2.2</b> Lesson Objectives</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="iterations.html"><a href="iterations.html#pulling-in-necessary-packages-and-data-sets"><i class="fa fa-check"></i><b>4.3</b> Pulling in necessary packages and data sets</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="iterations.html"><a href="iterations.html#exercise-1-1"><i class="fa fa-check"></i><b>4.3.1</b> Exercise #1</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="iterations.html"><a href="iterations.html#exploring-our-data"><i class="fa fa-check"></i><b>4.4</b> Exploring our data</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="iterations.html"><a href="iterations.html#exercise-2-1"><i class="fa fa-check"></i><b>4.4.1</b> Exercise #2</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="iterations.html"><a href="iterations.html#pivoting"><i class="fa fa-check"></i><b>4.5</b> Pivoting</a>
<ul>
<li class="chapter" data-level="4.5.1" data-path="iterations.html"><a href="iterations.html#exercise-3-1"><i class="fa fa-check"></i><b>4.5.1</b> Exercise #3</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="iterations.html"><a href="iterations.html#joining"><i class="fa fa-check"></i><b>4.6</b> Joining</a>
<ul>
<li class="chapter" data-level="4.6.1" data-path="iterations.html"><a href="iterations.html#exercise-4-1"><i class="fa fa-check"></i><b>4.6.1</b> Exercise #4</a></li>
<li class="chapter" data-level="4.6.2" data-path="iterations.html"><a href="iterations.html#exercise-5-1"><i class="fa fa-check"></i><b>4.6.2</b> Exercise #5</a></li>
</ul></li>
<li class="chapter" data-level="4.7" data-path="iterations.html"><a href="iterations.html#lesson-objectives-2"><i class="fa fa-check"></i><b>4.7</b> Lesson Objectives:</a></li>
<li class="chapter" data-level="4.8" data-path="iterations.html"><a href="iterations.html#streaflow-datasets"><i class="fa fa-check"></i><b>4.8</b> Streaflow Datasets</a>
<ul>
<li class="chapter" data-level="4.8.1" data-path="iterations.html"><a href="iterations.html#usgs-dataretrieval-r-package"><i class="fa fa-check"></i><b>4.8.1</b> USGS <code>dataRetrieval</code> R package</a></li>
<li class="chapter" data-level="4.8.2" data-path="iterations.html"><a href="iterations.html#cdwrs-api"><i class="fa fa-check"></i><b>4.8.2</b> CDWR‚Äôs API</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="exercise-1-2.html"><a href="exercise-1-2.html"><i class="fa fa-check"></i><b>5</b> Exercise #1</a></li>
<li class="chapter" data-level="6" data-path="exercise-2-2.html"><a href="exercise-2-2.html"><i class="fa fa-check"></i><b>6</b> Exercise #2</a></li>
<li class="chapter" data-level="7" data-path="exercise-3-2.html"><a href="exercise-3-2.html"><i class="fa fa-check"></i><b>7</b> Exercise #3</a></li>
<li class="chapter" data-level="8" data-path="exercise-4-2.html"><a href="exercise-4-2.html"><i class="fa fa-check"></i><b>8</b> Exercise #4</a></li>
<li class="chapter" data-level="9" data-path="exercise-5-2.html"><a href="exercise-5-2.html"><i class="fa fa-check"></i><b>9</b> Exercise #5</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">My bookdown</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="iterations" class="section level1 hasAnchor" number="4">
<h1><span class="header-section-number">Chapter 4</span> Iterations<a href="iterations.html#iterations" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>At this point, we now know how to develop functions so that we do not have to keep writing out redundant steps in a workflow. However, in that last exercise, you can see that we are <em>still</em> writing out redundant code; we are performing the exact same function on each of our three park units.</p>
<p>Another tool for reducing redundancy is <strong>iteration</strong>, which allows you to do the same thing on multiple inputs. Iteration can happen across different objects, different rows, different data frames, the list goes on and on!</p>
<div id="for-loops" class="section level2 hasAnchor" number="4.1">
<h2><span class="header-section-number">4.1</span> For loops<a href="iterations.html#for-loops" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>A <code>for</code> loop is base R‚Äôs iteration tool that executes code across a vector, an array, a list, etc. To save the outcome of each iteration, you must first create a vector to store the outputs in that is sized based on how many objects you want to iterate over. For example, I want to run our <code>parkwide_visitation()</code> function over the last five years: 2017, 2018, 2019, 2020, and 2021. To do that, I will first need to develop a vector listing each year:</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="iterations.html#cb34-1" aria-hidden="true" tabindex="-1"></a>years <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;2017&#39;</span>, <span class="st">&#39;2018&#39;</span>, <span class="st">&#39;2019&#39;</span>, <span class="st">&#39;2020&#39;</span>, <span class="st">&#39;2021&#39;</span>)</span></code></pre></div>
<p>‚Ä¶ and then develop an empty list to store each year‚Äôs <code>parkwide_visitation()</code> results (i.e., output) into:</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="iterations.html#cb35-1" aria-hidden="true" tabindex="-1"></a>output_floop <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="st">&quot;list&quot;</span>, <span class="at">length =</span> <span class="fu">length</span>(years))</span></code></pre></div>
<p>Now that we have a place to store each year‚Äôs function results, we can move forward with the for loop itself:</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="iterations.html#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(years)){</span>
<span id="cb36-2"><a href="iterations.html#cb36-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-3"><a href="iterations.html#cb36-3" aria-hidden="true" tabindex="-1"></a>  output_floop[[i]] <span class="ot">&lt;-</span></span>
<span id="cb36-4"><a href="iterations.html#cb36-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">parkwide_visitation</span>(<span class="at">year =</span> years[i])</span>
<span id="cb36-5"><a href="iterations.html#cb36-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-6"><a href="iterations.html#cb36-6" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>‚Ä¶ where <code>years[i]</code> tells the <code>for</code> loop to perform <code>parkwide_visitation()</code> on the <em>i<sup>th</sup></em> year (think of <em>i</em> as a moving across each year), and <code>output_floop[[i]]</code> directs the <code>for</code> loop to store the results of the <em>i<sup>th</sup></em> year‚Äôs run into <code>output</code>‚Äôs <em>i<sup>th</sup></em> list (think of <code>output_floop[[i]]</code> as the location in <code>output_floop</code> that the <em>i<sup>th</sup></em>‚Äôs results go).</p>
<p>We now have a list containing five data frames: one for each year of visitation data:</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="iterations.html#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(output_floop)</span></code></pre></div>
<pre><code>##      Length Class      Mode
## [1,] 6      data.frame list
## [2,] 6      data.frame list
## [3,] 6      data.frame list
## [4,] 6      data.frame list
## [5,] 6      data.frame list</code></pre>
<p>Because each year‚Äôs output is structured identically, we can confidently combine each year‚Äôs data frame into a single data frame using <code>dplyr::bind_rows()</code>:</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="iterations.html#cb39-1" aria-hidden="true" tabindex="-1"></a>multi_years <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">bind_rows</span>(output_floop)</span></code></pre></div>
<div id="exercise-6" class="section level3 hasAnchor" number="4.1.1" style="color: maroon">
<h3><span class="header-section-number">4.1.1</span> Exercise #6<a href="iterations.html#exercise-6" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><strong>Use a for loop to run <code>unit_visitation()</code> with arguments <code>start_year = 1980</code> and <code>end_year = 2021</code> across ROMO, EVER, and THRO. Then, create a single data frame containing each park units‚Äô output. (Hint: Your first step will be to create a vector listing each park unit.)</strong></p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="iterations.html#cb40-1" aria-hidden="true" tabindex="-1"></a>parks <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;ROMO&#39;</span>,<span class="st">&#39;EVER&#39;</span>, <span class="st">&#39;THRO&#39;</span>)</span>
<span id="cb40-2"><a href="iterations.html#cb40-2" aria-hidden="true" tabindex="-1"></a>outputfloop <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="st">&quot;list&quot;</span>, <span class="at">length =</span> <span class="fu">length</span>(parks))</span>
<span id="cb40-3"><a href="iterations.html#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(parks)){</span>
<span id="cb40-4"><a href="iterations.html#cb40-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb40-5"><a href="iterations.html#cb40-5" aria-hidden="true" tabindex="-1"></a>  outputfloop[[i]] <span class="ot">&lt;-</span></span>
<span id="cb40-6"><a href="iterations.html#cb40-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">unit_visitation</span>(<span class="at">park =</span>parks[i],<span class="at">startmonth =</span> <span class="dv">01</span>,<span class="at">startyear =</span> <span class="dv">1990</span>,<span class="at">endmonth =</span> <span class="dv">12</span>, <span class="at">endyear =</span> <span class="dv">2021</span>)}</span>
<span id="cb40-7"><a href="iterations.html#cb40-7" aria-hidden="true" tabindex="-1"></a>across_parks <span class="ot">&lt;-</span>dplyr<span class="sc">::</span><span class="fu">bind_rows</span>(outputfloop)</span>
<span id="cb40-8"><a href="iterations.html#cb40-8" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(across_parks)  </span></code></pre></div>
<pre><code>##      Month       NonRecreationVisitors RecreationVisitors   UnitCode        
##  Min.   : 1.00   Min.   :    0         Min.   :     0     Length:1152       
##  1st Qu.: 3.75   1st Qu.:  472         1st Qu.: 46259     Class :character  
##  Median : 6.50   Median :  623         Median : 73242     Mode  :character  
##  Mean   : 6.50   Mean   : 4572         Mean   :132738                       
##  3rd Qu.: 9.25   3rd Qu.: 6433         3rd Qu.:125563                       
##  Max.   :12.00   Max.   :40541         Max.   :973992                       
##    UnitName              Year     
##  Length:1152        Min.   :1990  
##  Class :character   1st Qu.:1998  
##  Mode  :character   Median :2006  
##                     Mean   :2006  
##                     3rd Qu.:2013  
##                     Max.   :2021</code></pre>
</div>
</div>
<div id="mapping" class="section level2 hasAnchor" number="4.2">
<h2><span class="header-section-number">4.2</span> Mapping<a href="iterations.html#mapping" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The <code>tidyverse</code>‚Äôs <code>purrr</code> package has its own iteration function, <code>map()</code>, that is a variation of the <code>for</code> loop. <code>map()</code> takes a vector and applies a single function across it, then automatically stores all of the results into a list. In other words, <code>map()</code> creates an appropriately sized list to store our results in for us. This eliminates the need to create an empty list ahead of time.</p>
<p>To create the same output as our previous <code>for</code> loop on <code>parkwide_visitation()</code>, but using <code>map()</code> instead, we would run the following code:</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="iterations.html#cb42-1" aria-hidden="true" tabindex="-1"></a>output_map <span class="ot">&lt;-</span> years <span class="sc">%&gt;%</span> </span>
<span id="cb42-2"><a href="iterations.html#cb42-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map</span>(<span class="sc">~</span> <span class="fu">parkwide_visitation</span>(<span class="at">year =</span> .))</span></code></pre></div>
<p>‚Ä¶ where <code>~</code> indicates that we want to perform <code>parkwide_visitation()</code> across all years, and <code>.</code> indicates that we want to use our piped vector, <code>years</code>, as the input to the <code>year</code> argument. As you can see, <code>output_map</code> is identical to <code>output_floop</code>:</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="iterations.html#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">identical</span>(output_floop, output_map)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p>‚Ä¶ which means we should also <code>bind_rows()</code> to get the mapped output into a single data frame:</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="iterations.html#cb45-1" aria-hidden="true" tabindex="-1"></a>multi_years <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(output_map)</span></code></pre></div>
<div id="exercise-7" class="section level3 hasAnchor" number="4.2.1" style="color: maroon">
<h3><span class="header-section-number">4.2.1</span> Exercise #7<a href="iterations.html#exercise-7" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><strong>Use <code>map()</code> to run <code>unit_visitation()</code> with arguments <code>start_year = 1980</code> and <code>end_year = 2021</code> across ROMO, EVER, and THRO. Then, create a single data frame containing each park units‚Äô output.</strong></p>

<p>#Data Munging</p>
</div>
<div id="lesson-objectives-1" class="section level3 hasAnchor" number="4.2.2">
<h3><span class="header-section-number">4.2.2</span> Lesson Objectives<a href="iterations.html#lesson-objectives-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>In the last lesson, we learned how to pull data from an API and reduce redundancies in our workflows through functions and iterations. In this lesson we will use the functions in the previous lesson to learn how to manipulate data frames with the <code>tidyverse</code>, and plot elegant time series graphs with the <code>ggplot()</code>, <code>scales</code> and <code>plotly</code> packages.</p>
<p>There are <strong>five exercises</strong> in this lesson that must be completed.</p>
</div>
</div>
<div id="pulling-in-necessary-packages-and-data-sets" class="section level2 hasAnchor" number="4.3">
<h2><span class="header-section-number">4.3</span> Pulling in necessary packages and data sets<a href="iterations.html#pulling-in-necessary-packages-and-data-sets" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="iterations.html#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;devtools&quot;</span>)</span>
<span id="cb46-2"><a href="iterations.html#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb46-3"><a href="iterations.html#cb46-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(httr)</span>
<span id="cb46-4"><a href="iterations.html#cb46-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(jsonlite)</span>
<span id="cb46-5"><a href="iterations.html#cb46-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(plotly)</span>
<span id="cb46-6"><a href="iterations.html#cb46-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scales)</span>
<span id="cb46-7"><a href="iterations.html#cb46-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;ggplotgui&quot;</span>)</span></code></pre></div>
<p>Using the <code>parkwide_visitation()</code> function from the last lesson and mapping, let‚Äôs pull park-wide visitor data from 1980-2021, and name the final object <code>parkwide</code>. (Code hack: we can use <code>1980:2021</code> to create a vector of years so we don‚Äôt have to write each year out!)</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="iterations.html#cb47-1" aria-hidden="true" tabindex="-1"></a>parkwide_visitation <span class="ot">&lt;-</span> <span class="cf">function</span>(year){</span>
<span id="cb47-2"><a href="iterations.html#cb47-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-3"><a href="iterations.html#cb47-3" aria-hidden="true" tabindex="-1"></a>raw_data <span class="ot">&lt;-</span> httr<span class="sc">::</span><span class="fu">GET</span>(<span class="at">url =</span> </span>
<span id="cb47-4"><a href="iterations.html#cb47-4" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb47-5"><a href="iterations.html#cb47-5" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">paste0</span>(<span class="st">&quot;https://irmaservices.nps.gov/v3/rest/stats/total/&quot;</span>, year))</span>
<span id="cb47-6"><a href="iterations.html#cb47-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-7"><a href="iterations.html#cb47-7" aria-hidden="true" tabindex="-1"></a>extracted_data <span class="ot">&lt;-</span> httr<span class="sc">::</span><span class="fu">content</span>(raw_data, <span class="at">as =</span> <span class="st">&quot;text&quot;</span>, <span class="at">encoding =</span> <span class="st">&quot;UTF-8&quot;</span>) </span>
<span id="cb47-8"><a href="iterations.html#cb47-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-9"><a href="iterations.html#cb47-9" aria-hidden="true" tabindex="-1"></a>final_data <span class="ot">&lt;-</span> jsonlite<span class="sc">::</span><span class="fu">fromJSON</span>(extracted_data)</span>
<span id="cb47-10"><a href="iterations.html#cb47-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-11"><a href="iterations.html#cb47-11" aria-hidden="true" tabindex="-1"></a><span class="fu">return</span>(final_data)</span>
<span id="cb47-12"><a href="iterations.html#cb47-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-13"><a href="iterations.html#cb47-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb47-14"><a href="iterations.html#cb47-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-15"><a href="iterations.html#cb47-15" aria-hidden="true" tabindex="-1"></a>years <span class="ot">&lt;-</span> (<span class="dv">1980</span><span class="sc">:</span><span class="dv">2021</span>)</span>
<span id="cb47-16"><a href="iterations.html#cb47-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-17"><a href="iterations.html#cb47-17" aria-hidden="true" tabindex="-1"></a>parkwide <span class="ot">&lt;-</span> years <span class="sc">%&gt;%</span> </span>
<span id="cb47-18"><a href="iterations.html#cb47-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map</span>(<span class="sc">~</span> <span class="fu">parkwide_visitation</span>(<span class="at">year =</span> .)) <span class="sc">%&gt;%</span> </span>
<span id="cb47-19"><a href="iterations.html#cb47-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>()</span></code></pre></div>
<div id="exercise-1-1" class="section level3 hasAnchor" number="4.3.1" style="color: maroon">
<h3><span class="header-section-number">4.3.1</span> Exercise #1<a href="iterations.html#exercise-1-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><strong>Using the <code>unit_visitation()</code> function from the last lesson and mapping, pull visitor data from 1980-2021 for the following park units: ROMO, ACAD, LAKE, YELL, GRCA, ZION, OLYM, and GRSM. Name the final output <code>units</code>.</strong></p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="iterations.html#cb48-1" aria-hidden="true" tabindex="-1"></a>alltheparks<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="st">&quot;ROMO&quot;</span>,<span class="st">&quot;ACAD&quot;</span>,<span class="st">&quot;LAKE&quot;</span>,<span class="st">&quot;YELL&quot;</span>,<span class="st">&quot;GRCA&quot;</span>,<span class="st">&quot;ZION&quot;</span>,<span class="st">&quot;OLYM&quot;</span>,<span class="st">&quot;GRSM&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb48-2"><a href="iterations.html#cb48-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-3"><a href="iterations.html#cb48-3" aria-hidden="true" tabindex="-1"></a>units<span class="ot">&lt;-</span> <span class="fu">unit_visitation</span>(<span class="at">park=</span>.,)</span>
<span id="cb48-4"><a href="iterations.html#cb48-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-5"><a href="iterations.html#cb48-5" aria-hidden="true" tabindex="-1"></a>units<span class="ot">&lt;-</span> alltheparks <span class="sc">%&gt;%</span></span>
<span id="cb48-6"><a href="iterations.html#cb48-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map</span>(<span class="sc">~</span><span class="fu">unit_visitation</span>(<span class="at">park=</span>.,<span class="at">startyear=</span><span class="dv">1980</span>,<span class="at">endyear=</span><span class="dv">2021</span>))<span class="sc">%&gt;%</span></span>
<span id="cb48-7"><a href="iterations.html#cb48-7" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_rows</span>()</span></code></pre></div>
</div>
</div>
<div id="exploring-our-data" class="section level2 hasAnchor" number="4.4">
<h2><span class="header-section-number">4.4</span> Exploring our data<a href="iterations.html#exploring-our-data" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Look at the data frame structure of <code>parkwide</code> and <code>units</code>; they‚Äôre exactly the same! So let‚Äôs go ahead and bind those together:</p>
<p>‚Ä¶ except, the rows in <code>parkwide</code>‚Äôs UnitCode and UnitCode columns are empty. üòë Let‚Äôs fix the <code>UnitCode</code> column to list ‚ÄúParkwide‚Äù using <code>mutate()</code> and an <code>ifelse()</code> statement:</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="iterations.html#cb49-1" aria-hidden="true" tabindex="-1"></a>visitation <span class="ot">&lt;-</span> units <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">UnitCode =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(UnitCode), <span class="st">&quot;Parkwide&quot;</span>, UnitCode))</span></code></pre></div>
<p>Think of the above <code>ifelse()</code> operation as: ‚ÄúIf the column <code>UnitCode</code> is <code>NA</code>, replace <code>NA</code> with <code>Parkwide</code>. Otherwise, preserve what is already in the <code>UnitCode</code> column.‚Äù</p>
<p>Now that we have a single data set containing all of the NPS visitation data that we‚Äôve pulled, let‚Äôs start exploring it! But first, let‚Äôs aggregate the monthly data into annual data using <code>group_by()</code> and <code>summarize()</code>:</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="iterations.html#cb50-1" aria-hidden="true" tabindex="-1"></a>yearly <span class="ot">&lt;-</span> visitation <span class="sc">%&gt;%</span></span>
<span id="cb50-2"><a href="iterations.html#cb50-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(UnitCode, Year) <span class="sc">%&gt;%</span> </span>
<span id="cb50-3"><a href="iterations.html#cb50-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># we only care about recreational visitors:</span></span>
<span id="cb50-4"><a href="iterations.html#cb50-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">RecVisitation =</span> <span class="fu">sum</span>(RecreationVisitors))</span>
<span id="cb50-5"><a href="iterations.html#cb50-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-6"><a href="iterations.html#cb50-6" aria-hidden="true" tabindex="-1"></a>yearly</span></code></pre></div>
<p>What does visitation data look like through time? First we can try to graph all of the park units together:</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="iterations.html#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>yearly)<span class="sc">+</span></span>
<span id="cb51-2"><a href="iterations.html#cb51-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> Year, <span class="at">y =</span> RecVisitation, <span class="at">color =</span> UnitCode)) <span class="sc">+</span></span>
<span id="cb51-3"><a href="iterations.html#cb51-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_path</span>(<span class="fu">aes</span>(<span class="at">x =</span> Year, <span class="at">y =</span> RecVisitation, <span class="at">color =</span> UnitCode)) <span class="sc">+</span></span>
<span id="cb51-4"><a href="iterations.html#cb51-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_scientific</span>()) <span class="sc">+</span></span>
<span id="cb51-5"><a href="iterations.html#cb51-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size=</span><span class="dv">10</span>)</span></code></pre></div>
<p>‚Ä¶ yikes, not surprisingly, parkwide visitation is wayyyy higher than our individual unit‚Äôs visitation data, making our graph pretty useless. It might be nice to have each park unit in a graph of its own.</p>
<p>We can create individual graphs for each unit using <code>facet_wrap()</code>, and set the y-axes for each plot to <code>"free_y"</code>:</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="iterations.html#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>yearly) <span class="sc">+</span></span>
<span id="cb52-2"><a href="iterations.html#cb52-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> Year, <span class="at">y =</span> RecVisitation, <span class="at">color =</span> UnitCode)) <span class="sc">+</span></span>
<span id="cb52-3"><a href="iterations.html#cb52-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_path</span>(<span class="fu">aes</span>(<span class="at">x =</span> Year, <span class="at">y =</span> RecVisitation, <span class="at">color =</span> UnitCode)) <span class="sc">+</span></span>
<span id="cb52-4"><a href="iterations.html#cb52-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_scientific</span>()) <span class="sc">+</span></span>
<span id="cb52-5"><a href="iterations.html#cb52-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>UnitCode, <span class="at">scales =</span> <span class="st">&quot;free_y&quot;</span>) <span class="sc">+</span></span>
<span id="cb52-6"><a href="iterations.html#cb52-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size=</span><span class="dv">10</span>)</span></code></pre></div>
<p>We can also make this plot interactive by feeding it into <code>plotly</code>‚Äôs <code>ggplotly()</code> function:</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="iterations.html#cb53-1" aria-hidden="true" tabindex="-1"></a>plotly<span class="sc">::</span><span class="fu">ggplotly</span>(</span>
<span id="cb53-2"><a href="iterations.html#cb53-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">data=</span>yearly) <span class="sc">+</span></span>
<span id="cb53-3"><a href="iterations.html#cb53-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> Year, <span class="at">y =</span> RecVisitation, <span class="at">color =</span> UnitCode)) <span class="sc">+</span></span>
<span id="cb53-4"><a href="iterations.html#cb53-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_path</span>(<span class="fu">aes</span>(<span class="at">x =</span> Year, <span class="at">y =</span> RecVisitation, <span class="at">color =</span> UnitCode)) <span class="sc">+</span></span>
<span id="cb53-5"><a href="iterations.html#cb53-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_scientific</span>()) <span class="sc">+</span></span>
<span id="cb53-6"><a href="iterations.html#cb53-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span>UnitCode, <span class="at">scales =</span> <span class="st">&quot;free_y&quot;</span>) <span class="sc">+</span></span>
<span id="cb53-7"><a href="iterations.html#cb53-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>(<span class="at">base_size=</span><span class="dv">10</span>)</span>
<span id="cb53-8"><a href="iterations.html#cb53-8" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div id="exercise-2-1" class="section level3 hasAnchor" number="4.4.1" style="color: maroon">
<h3><span class="header-section-number">4.4.1</span> Exercise #2<a href="iterations.html#exercise-2-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><strong>Create an interactive graph with two separate panes: one showing park-wide visitation, the other showing all the individual park units together. Both panes should have different y-axes.</strong></p>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="iterations.html#cb54-1" aria-hidden="true" tabindex="-1"></a>plotly<span class="sc">::</span><span class="fu">ggplotly</span>(</span>
<span id="cb54-2"><a href="iterations.html#cb54-2" aria-hidden="true" tabindex="-1"></a> pane1<span class="ot">&lt;-</span><span class="fu">ggplot</span>(<span class="at">data=</span>yearly)<span class="sc">+</span></span>
<span id="cb54-3"><a href="iterations.html#cb54-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> Year, <span class="at">y =</span> RecVisitation, <span class="at">color =</span> UnitCode)) <span class="sc">+</span></span>
<span id="cb54-4"><a href="iterations.html#cb54-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_path</span>(<span class="fu">aes</span>(<span class="at">x =</span> Year, <span class="at">y =</span> RecVisitation, <span class="at">color =</span> UnitCode)) <span class="sc">+</span></span>
<span id="cb54-5"><a href="iterations.html#cb54-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_scientific</span>()) <span class="sc">+</span></span>
<span id="cb54-6"><a href="iterations.html#cb54-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size=</span><span class="dv">10</span>) )</span>
<span id="cb54-7"><a href="iterations.html#cb54-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-8"><a href="iterations.html#cb54-8" aria-hidden="true" tabindex="-1"></a>plotly<span class="sc">::</span> <span class="fu">ggplotly</span>(pane1<span class="sc">+</span><span class="fu">facet_grid</span>(<span class="sc">~</span>UnitCode, <span class="at">scales =</span> <span class="st">&quot;free_y&quot;</span>) <span class="sc">+</span></span>
<span id="cb54-9"><a href="iterations.html#cb54-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>(<span class="at">base_size=</span><span class="dv">10</span>))</span></code></pre></div>
<p>It is pretty clear that some park units get orders of magnitude more visitors than others. But just how much of the total park visitation do each of these parks account for from year to year? Here we walk through two methods to tackle this question, <strong><em>pivoting</em></strong> and <strong><em>joining</em></strong>, to get park unit visitation side-by-side with park-wide data.</p>
</div>
</div>
<div id="pivoting" class="section level2 hasAnchor" number="4.5">
<h2><span class="header-section-number">4.5</span> Pivoting<a href="iterations.html#pivoting" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Currently, our yearly data is considered <em>narrow</em> because we have all of our NPS visitation data in one column, with multiple rows representing the same year. We can make this data <em>wide</em> by using the function <code>pivot_wider()</code></p>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="iterations.html#cb55-1" aria-hidden="true" tabindex="-1"></a>wide_data <span class="ot">&lt;-</span> yearly <span class="sc">%&gt;%</span></span>
<span id="cb55-2"><a href="iterations.html#cb55-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Year, UnitCode, RecVisitation) <span class="sc">%&gt;%</span></span>
<span id="cb55-3"><a href="iterations.html#cb55-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(., <span class="at">names_from =</span> UnitCode, <span class="at">values_from =</span> RecVisitation)</span></code></pre></div>
<p>‚Ä¶ where <code>names_from</code> represents the column with the values you are hoping to spread into new columns, and <code>values_from</code> represents the data you want to fill these new columns with.</p>
<p>We can make the data set <em>narrow</em> again by using the function <code>pivot_longer()</code>:</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="iterations.html#cb56-1" aria-hidden="true" tabindex="-1"></a>narrow_data <span class="ot">&lt;-</span> wide_data <span class="sc">%&gt;%</span></span>
<span id="cb56-2"><a href="iterations.html#cb56-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">-</span>Year,</span>
<span id="cb56-3"><a href="iterations.html#cb56-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">&quot;Park&quot;</span>,</span>
<span id="cb56-4"><a href="iterations.html#cb56-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">&quot;RecVisitation&quot;</span>)</span></code></pre></div>
<p>‚Ä¶ where <code>cols</code> are the columns we want to gather into one column (or, the column(s) you DON‚ÄôT want to gather), while <code>names_to</code> and <code>values_to</code> are the names of the new columns produced from the pivot.</p>
<div id="exercise-3-1" class="section level3 hasAnchor" number="4.5.1" style="color: maroon">
<h3><span class="header-section-number">4.5.1</span> Exercise #3<a href="iterations.html#exercise-3-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><strong>Using <code>wide_data</code> as the starting point, create an interactive time series plot showing the annual percentage of the total visitation made up by all park units.</strong></p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="iterations.html#cb57-1" aria-hidden="true" tabindex="-1"></a> plotly<span class="sc">::</span><span class="fu">ggplotly</span>(<span class="fu">ggplot</span>(<span class="at">data=</span> wide_data)<span class="sc">+</span></span>
<span id="cb57-2"><a href="iterations.html#cb57-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> Year, <span class="at">y =</span> parks1)) <span class="sc">+</span></span>
<span id="cb57-3"><a href="iterations.html#cb57-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_scientific</span>()) <span class="sc">+</span></span>
<span id="cb57-4"><a href="iterations.html#cb57-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size=</span><span class="dv">10</span>) )</span></code></pre></div>
</div>
</div>
<div id="joining" class="section level2 hasAnchor" number="4.6">
<h2><span class="header-section-number">4.6</span> Joining<a href="iterations.html#joining" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Another way of getting park-wide visitation side-by-side with the park unit data is through the use of joining our original <code>units</code> and <code>parkwide</code> data sets:</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="iterations.html#cb58-1" aria-hidden="true" tabindex="-1"></a>joined_data <span class="ot">&lt;-</span> <span class="fu">inner_join</span>(<span class="at">x =</span> units, <span class="at">y =</span> parkwide, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;Year&quot;</span>,<span class="st">&quot;Month&quot;</span>))</span></code></pre></div>
<p>‚Ä¶ where <code>x</code> and <code>y</code> are the two data sets you want joined, and <code>by</code> indicates the column(s) to match them by. Note: there are several ways of joining data. Explore them with <code>?`mutate-joins`</code> and <code>?`filter-joins`</code>.</p>
<div id="exercise-4-1" class="section level3 hasAnchor" number="4.6.1" style="color: maroon">
<h3><span class="header-section-number">4.6.1</span> Exercise #4<a href="iterations.html#exercise-4-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><strong>Using <code>joined_data</code> as the starting point, create an interactive time series plot showing the annual percentage of the total visitation made up by all park units. This plot should look nearly identical to the previous plot.</strong></p>
</div>
<div id="exercise-5-1" class="section level3 hasAnchor" number="4.6.2" style="color: maroon">
<h3><span class="header-section-number">4.6.2</span> Exercise #5<a href="iterations.html#exercise-5-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><strong>Which park on average has the most visitation? Which park has the least visitation? Base your response on the data starting in 1990, ending in 2021. Defend your answer with numbers!</strong></p>

<p>#Denouement</p>
</div>
</div>
<div id="lesson-objectives-2" class="section level2 hasAnchor" number="4.7">
<h2><span class="header-section-number">4.7</span> Lesson Objectives:<a href="iterations.html#lesson-objectives-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>In this lesson you will take all of the skills you have learned up to this point and use them on a completely new set of data. This lesson has <strong>five exercises</strong> that need to be completed.</p>
<div id="necessary-packages" class="section level4 hasAnchor" number="4.7.0.1">
<h4><span class="header-section-number">4.7.0.1</span> Necessary packages:<a href="iterations.html#necessary-packages" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="iterations.html#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb59-2"><a href="iterations.html#cb59-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(plotly)</span>
<span id="cb59-3"><a href="iterations.html#cb59-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scales)</span>
<span id="cb59-4"><a href="iterations.html#cb59-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(httr)</span>
<span id="cb59-5"><a href="iterations.html#cb59-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(jsonlite)</span>
<span id="cb59-6"><a href="iterations.html#cb59-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dataRetrieval)</span>
<span id="cb59-7"><a href="iterations.html#cb59-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf) <span class="co"># for the map</span></span>
<span id="cb59-8"><a href="iterations.html#cb59-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mapview) <span class="co"># for making the interactive plot</span></span></code></pre></div>
</div>
</div>
<div id="streaflow-datasets" class="section level2 hasAnchor" number="4.8">
<h2><span class="header-section-number">4.8</span> Streaflow Datasets<a href="iterations.html#streaflow-datasets" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>We are interested in looking at how the Cache la Poudre River‚Äôs flow changes as it travels out of the mountainous Poudre Canyon and through Fort Collins.</p>
<p>There are four stream flow monitoring sites on the Poudre that we are interested in: two managed by the US Geological Survey (USGS), and two managed by the Colorado Division of Water Resources (CDWR):</p>
<div id="usgs-dataretrieval-r-package" class="section level3 hasAnchor" number="4.8.1">
<h3><span class="header-section-number">4.8.1</span> USGS <code>dataRetrieval</code> R package<a href="iterations.html#usgs-dataretrieval-r-package" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>To pull data for USGS stream gages, we can use the <code>dataRetrieval</code> package, which is a USGS-managed set of functions that, much like our functions from Lesson 3.1, pull data from the USGS‚Äôs data warehouse using an API. Here we will pull flow data for our USGS stream gages of interest for the last two water years:</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="iterations.html#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="co"># pulls USGS daily (&#39;dv&#39;) stream flow data:</span></span>
<span id="cb60-2"><a href="iterations.html#cb60-2" aria-hidden="true" tabindex="-1"></a>usgs <span class="ot">&lt;-</span> dataRetrieval<span class="sc">::</span><span class="fu">readNWISdv</span>(<span class="at">siteNumbers =</span> <span class="fu">c</span>(<span class="st">&quot;06752260&quot;</span>, <span class="st">&quot;06752280&quot;</span>), <span class="co"># USGS site code for the Poudre River at the Lincoln Bridge and the ELC</span></span>
<span id="cb60-3"><a href="iterations.html#cb60-3" aria-hidden="true" tabindex="-1"></a>                               <span class="at">parameterCd =</span> <span class="st">&quot;00060&quot;</span>, <span class="co"># USGS code for stream flow</span></span>
<span id="cb60-4"><a href="iterations.html#cb60-4" aria-hidden="true" tabindex="-1"></a>                               <span class="at">startDate =</span> <span class="st">&quot;2020-10-01&quot;</span>, <span class="co"># YYYY-MM-DD formatting</span></span>
<span id="cb60-5"><a href="iterations.html#cb60-5" aria-hidden="true" tabindex="-1"></a>                               <span class="at">endDate =</span> <span class="st">&quot;2022-09-30&quot;</span>) <span class="sc">%&gt;%</span> <span class="co"># YYYY-MM-DD formatting</span></span>
<span id="cb60-6"><a href="iterations.html#cb60-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">q_cfs =</span> X_00060_00003) <span class="sc">%&gt;%</span> <span class="co"># USGS code for stream flow units in cubic feet per second (CFS)</span></span>
<span id="cb60-7"><a href="iterations.html#cb60-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Date =</span> lubridate<span class="sc">::</span><span class="fu">ymd</span>(Date), <span class="co"># convert the Date column to &quot;Date&quot; formatting using the `lubridate` package</span></span>
<span id="cb60-8"><a href="iterations.html#cb60-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">Site =</span> <span class="fu">case_when</span>(site_no <span class="sc">==</span> <span class="st">&quot;06752260&quot;</span> <span class="sc">~</span> <span class="st">&quot;Lincoln&quot;</span>, </span>
<span id="cb60-9"><a href="iterations.html#cb60-9" aria-hidden="true" tabindex="-1"></a>                          site_no <span class="sc">==</span> <span class="st">&quot;06752280&quot;</span> <span class="sc">~</span> <span class="st">&quot;Boxelder&quot;</span>))</span></code></pre></div>
</div>
<div id="cdwrs-api" class="section level3 hasAnchor" number="4.8.2">
<h3><span class="header-section-number">4.8.2</span> CDWR‚Äôs API<a href="iterations.html#cdwrs-api" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Alas, CDWR does NOT have an R package that pulls data from <a href="https://dwr.state.co.us/Rest/GET/Help#Datasets&amp;#SurfaceWaterController&amp;#gettingstarted&amp;#jsonxml">their API</a>, but they do have user-friendly directions on how to develop API calls.</p>
<p>Using the ‚ÄúURL generator‚Äù steps outlined for their <a href="https://dwr.state.co.us/Rest/GET/Help/SurfaceWaterTSDayGenerator">daily surface water time series data set</a>, we can get the last two water years of CFS data for the Poudre at the Canyon mouth (site abbreviation = CLAFTCCO) using the following URL:</p>
<p><a href="https://dwr.state.co.us/Rest/GET/api/v2/surfacewater/surfacewatertsday/?format=json&amp;dateFormat=dateOnly&amp;fields=abbrev%2CmeasDate%2Cvalue%2CmeasUnit&amp;encoding=deflate&amp;abbrev=CLAFTCCO&amp;min-measDate=10%2F01%2F2020&amp;max-measDate=09%2F30%2F2022" class="uri">https://dwr.state.co.us/Rest/GET/api/v2/surfacewater/surfacewatertsday/?format=json&amp;dateFormat=dateOnly&amp;fields=abbrev%2CmeasDate%2Cvalue%2CmeasUnit&amp;encoding=deflate&amp;abbrev=CLAFTCCO&amp;min-measDate=10%2F01%2F2020&amp;max-measDate=09%2F30%2F2022</a></p>
</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="functions.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="exercise-1-2.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
